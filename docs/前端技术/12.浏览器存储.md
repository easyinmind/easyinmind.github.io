---
title: 浏览器存储
date: 2021-01-28 11:35:09
permalink: /pages/b90cc4/
categories:
  - 前端技术
tags:
  - 
---
# 浏览器存储

## Cookie
> 非本地存储，而是“维持状态”   
> 存储在浏览器里的一个小小的文本文件，它附着在 HTTP 请求上   
> http是一个无状态协议，Cookie携带用户信息，当服务器检查 Cookie 的时候，便可以获取到客户端的状态

缺点:   
1. Cookie 不够大，4kb
2. 过量的 Cookie 会带来巨大的性能浪费
   1. Cookie 是紧跟域名的，通过响应头里的 Set-Cookie 指定要存储的 Cookie 值。domain 被设置为设置 Cookie 页面的主机名，我们也可以手动设置 domain 的值`Set-Cookie: name=xiuyan; domain=xiuyan.me`
   2. 同一个域名下的所有请求，都会携带 Cookie。
3. 只能储存字符串，JavaScript中去处理cookie是一件很繁琐的事
4. 不安全：储在Cookie的任何数据可以被他人访问

## cookie 生成方式
1. http response header中的set-cookie：`Set-Cookie: id=a3fWa; Expires=Wed, 21 Oct 2018 07:28:00 GMT;//可以指定一个特定的过期时间（Expires）或有效期（Max-Age）
`
2. js中可以通过document.cookie可以读写cookie，以键值对的形式展示：`document.cookie='age=20;domain=.baidu.com'
`，所有以.baidu.com结尾的域名都可以访问该cookie，其它域名则不行。

## cookie 注意
1. 各浏览器的cookie每一个name=value的value值大概在4k，所以4k并不是一个域名下所有的cookie共享的,而是一个name的大小。
2. 同一个域名下的所有请求，都会携带 Cookie，静态资源没必要携带，可以通过cdn（存储静态文件的）的域名和主站的域名分开来解决

## cookie 安全
HttpOnly 不支持读写，浏览器不允许脚本操作document.cookie去更改cookie，
所以为避免跨域脚本 (XSS) 攻击，通过JavaScript的 Document.cookie API无法访问带有 HttpOnly 标记的Cookie，它们只应该发送给服务端。如果包含服务端 Session 信息的 Cookie 不想被客户端 JavaScript 脚本调用，那么就应该为其设置 HttpOnly 标记
```
Set-Cookie: id=a3fWa; Expires=Wed, 21 Oct 2015 07:28:00 GMT; Secure; HttpOnly
```

## Web Storage
> HTML5 专门为浏览器存储而提供的数据存储机制

## Local Storage 与 Session Storage 的区别
1. 生命周期：Local Storage 是持久化的本地存储，存储在其中的数据是永远不会过期的，使其消失的唯一办法是手动删除；而 Session Storage 是临时性的本地存储，它是会话级别的存储，当会话结束（页面被关闭）时，存储内容也随之被释放。
2. 作用域：Local Storage、Session Storage 和 Cookie 都遵循同源策略。但 Session Storage 特别的一点在于，即便是相同域名下的两个页面，只要它们不在同一个浏览器窗口中打开，那么它们的 Session Storage 内容便无法共享。

## 特点
1. 存储容量大： Web Storage 根据浏览器的不同，存储容量可以达到 5-10M 之间。
2. 仅位于浏览器端，不与服务端发生通信。
3. js操作简单
## 常用方法
```js
localStorage.setItem('user_name', 'xiuyan')
localStorage.getItem('user_name')
localStorage.removeItem('user_name')
localStorage.clear()
```
## 场景
如： Local Storage 存储Base64 格式的图片字符串

## IndexedDB
> 运行在浏览器上的非关系型数据库

IndexedDB 可以看做是 LocalStorage 的一个升级，当数据的复杂度和规模上升到了 LocalStorage 无法解决的程度，我们毫无疑问可以请出 IndexedDB 来帮忙。   
几乎所有浏览器都对 indexedDB 有了不错的支持