(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{418:function(s,a,e){"use strict";e.r(a);var t=e(21),n=Object(t.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h2",{attrs:{id:"webpack"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#webpack"}},[s._v("#")]),s._v(" webpack")]),s._v(" "),e("p",[s._v("基于webpack5 + react hooks + ts + less 项目搭建流程")]),s._v(" "),e("p",[s._v("搭建过程中会描述各项配置的作用，以及一些常用点的讲解")]),s._v(" "),e("h2",{attrs:{id:"一、安装-webpack-及-webpack-cli"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#一、安装-webpack-及-webpack-cli"}},[s._v("#")]),s._v(" 一、安装 "),e("code",[s._v("webpack")]),s._v(" 及 "),e("code",[s._v("webpack-cli")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("npm i webpack webpack-cli -D\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("可以全局安装-G，建议安装在项目内（不同项目版本可能有区别，减少对项目的影响）")]),s._v(" "),e("p",[s._v("默认配置：")]),s._v(" "),e("ul",[e("li",[s._v("入口："),e("code",[s._v("src/index.js")])]),s._v(" "),e("li",[s._v("出口："),e("code",[s._v("dist/main.js")])]),s._v(" "),e("li",[s._v("mode： "),e("code",[s._v("production")]),s._v(" (开启压缩和优化)")])]),s._v(" "),e("p",[s._v("运行："),e("code",[s._v("npx webpack")]),s._v(" node v8.2版本以后都会有一个npx，npx会执行bin里的文件（webpack）")]),s._v(" "),e("p",[s._v("关于 "),e("code",[s._v("mode")]),s._v("：")]),s._v(" "),e("p",[s._v("默认值： "),e("code",[s._v("production")])]),s._v(" "),e("p",[s._v("设置mode可以改变 process.env.NODE_ENV 的值")]),s._v(" "),e("p",[s._v("配置文件")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("module.exports = {\n  mode: 'production'\n};\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("p",[s._v("命令行")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("webpack --mode=production\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("development： 会将 DefinePlugin 中 process.env.NODE_ENV 的值设置为 development. 为模块和 chunk 启用有效的名（会开启一些插件）")]),s._v(" "),e("li",[s._v("production：会将 DefinePlugin 中 process.env.NODE_ENV 的值设置为 production 。为模块和 chunk 启用确定性的混淆名称，并开启其它的一些生产环境的优化（会开启一些插件）")]),s._v(" "),e("li",[s._v("none：不使用任何默认优化选项")]),s._v(" "),e("li",[s._v("不同 mode 对应的配置、插件可查看文档")])]),s._v(" "),e("p",[s._v("关于 "),e("code",[s._v("context")]),s._v(" 上下文:")]),s._v(" "),e("p",[s._v("默认值是 "),e("code",[s._v("process.cwd()")]),s._v(" （当前node执行的文件夹地址），推荐将 context 修改为项目的根目录，这样可以使得项目配置独立于CWD")]),s._v(" "),e("p",[s._v("context 是 webpack 编译时的基础目录，是一个绝对路径的字符串，context 用于解析配置中的entry、loader、plugins中的相对路径（除了output），配置方式同 "),e("code",[s._v("mode")]),s._v(" 参数")]),s._v(" "),e("h2",{attrs:{id:"二、增加配置文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#二、增加配置文件"}},[s._v("#")]),s._v(" 二、增加配置文件")]),s._v(" "),e("p",[s._v("默认运行 "),e("code",[s._v("webpack")]),s._v(" 会去查找 webpack.congif.js 配置文件，如果没有这个文件会使用默认值，可以通过如下方式指定配置文件：")]),s._v(" "),e("p",[s._v("命令行（推荐这种方式）")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("webpack --config xxx.js\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("或者在 webpack.congif.js 通过环境变量指定配置")]),s._v(" "),e("h2",{attrs:{id:"三、配置入口-enry-及出口-output"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#三、配置入口-enry-及出口-output"}},[s._v("#")]),s._v(" 三、配置入口（"),e("code",[s._v("enry")]),s._v("）及出口（"),e("code",[s._v("output")]),s._v("）")]),s._v(" "),e("p",[s._v("命令行")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("webpack 入口 出口\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("配置文件")]),s._v(" "),e("div",{staticClass:"language-js line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[s._v("module"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 单入口 => 单输出（一个chunk，SPA）")]),s._v("\n  entry"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 多入口 => 单输出（一个chunk， SPA）")]),s._v("\n  entry"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 多入口 => 多输出（多个chunk， MPA）")]),s._v("\n  entry"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n  \n\n  output"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// entry 里的输出文件名")]),s._v("\n    filename"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"[name].min.js"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 非entry 里的输出文件名")]),s._v("\n    chunkFilename"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'bundle.js'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 输出的文件目录")]),s._v("\n    path"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" path"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("join")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("__dirname"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/dist"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 个人理解，文件引用的前缀（如： 设置为CDN地址等）")]),s._v("\n    publicPath"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br")])]),e("p",[s._v("这里涉及到一些 chunk 及 占位符的概念，后面会讲到")]),s._v(" "),e("h2",{attrs:{id:"四、配置样式相关的-loader"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#四、配置样式相关的-loader"}},[s._v("#")]),s._v(" 四、配置样式相关的 loader")]),s._v(" "),e("p",[s._v("webpack 默认识别js文件，但不认识css、less等文件，所以需要使用一些loader进行处理，这里不写loader的基础配置（具体配置可查看配置文件或文档），只关心一些常用配置点和注意")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("npm i style-loader css-loader less less-loader postcss postcss-loader -D\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[e("p",[e("code",[s._v("less-loader sass-loader stylus-loader postcss-loader")]),s._v(" 等css预处理器loader需要安装对应的预处理器 "),e("code",[s._v("less sass stylus postcss")])])]),s._v(" "),e("li",[e("p",[e("code",[s._v("less-loader")]),s._v(" 支持less文件")])]),s._v(" "),e("li",[e("p",[e("code",[s._v("postcss-loader")])]),s._v(" "),e("ul",[e("li",[s._v("放在 预编译器之后，css-loader之前执行")]),s._v(" "),e("li",[s._v("可以使用配置文件")]),s._v(" "),e("li",[s._v("通过插件增加浏览器前缀，postcss-preset-env 包含 autoprefixer")])])]),s._v(" "),e("li",[e("p",[e("code",[s._v("css-loader")]),s._v(" 用来处理@import、url()语法（把 css 代码打包进 js 文件而已，并不做任何操作）")]),s._v(" "),e("ul",[e("li",[s._v("modules css模块化配置")]),s._v(" "),e("li",[s._v("importLoaders css-loader 之前有多少 loader 应用于@import")])])]),s._v(" "),e("li",[e("p",[e("code",[s._v("style-loader")]),s._v(" 将css插入dom中")])])]),s._v(" "),e("h2",{attrs:{id:"四、配置图片及字体文件相关-loader"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#四、配置图片及字体文件相关-loader"}},[s._v("#")]),s._v(" 四、配置图片及字体文件相关 loader")]),s._v(" "),e("p",[s._v("支持图片、字体等文件")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("npm i url-loader -D\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("url-loader 功能类似于 file-loader，增加了 "),e("code",[s._v("limit")]),s._v(" 属性，可以设置返回 DataURL，用来减少http请求。这两个使用一个即可")]),s._v(" "),e("h2",{attrs:{id:"五、配置-babel-支持-es6-jsx-ts"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#五、配置-babel-支持-es6-jsx-ts"}},[s._v("#")]),s._v(" 五、配置 babel 支持 ES6, JSX, TS")]),s._v(" "),e("p",[s._v("主要是babel相关的用法，配置可参考项目内，babel更多详细内容 会另写一篇文章")]),s._v(" "),e("ul",[e("li",[s._v("babel 一些概念，核心包、预设、插件等")]),s._v(" "),e("li",[s._v("babel 和 webpack 的区别")]),s._v(" "),e("li",[s._v("babel-runtime、polyfil")]),s._v(" "),e("li",[s._v("自定义插件")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("npm i babel-loader @babel/core @babel/preset-env @babel/preset-react @babel/preset-typescript -D\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("配置 "),e("code",[s._v("tsconfig.json")])]),s._v(" "),e("h2",{attrs:{id:"六、配置本地开发环境-webpack-dev-serve"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#六、配置本地开发环境-webpack-dev-serve"}},[s._v("#")]),s._v(" 六、配置本地开发环境 webpack-dev-serve")]),s._v(" "),e("p",[s._v("如果不进行文件监听配置，在本地开发环境下，每次修改代码都需要手动打包刷新浏览器，常用本地开发配置主要通过下面几种方式：")]),s._v(" "),e("ul",[e("li",[e("p",[s._v("watch监听 "),e("code",[s._v("webpack --watch")]),e("br"),s._v("\n开启这个配置会监听文件配置，自动打包（需要手动刷新浏览器、通过file协议访问）")])]),s._v(" "),e("li",[e("p",[s._v("通过 webpack-dev-server + devServer")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("npm i webpack-dev-server\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("div",{staticClass:"language-js line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[s._v("devServer"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ...")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])])]),s._v(" "),e("li",[e("p",[s._v("通过 webpack-dev-middleware + 自定义node服务配置"),e("br"),s._v("\n自己写一个webpack-dev-server")])])]),s._v(" "),e("p",[s._v("通常使用 webpack-dev-server，使用本地服务方式，打包文件放在了内存中，提升速度，并且可以使用 ajax请求数据，代理接口")]),s._v(" "),e("p",[s._v("关于 "),e("code",[s._v("HMR")]),e("br"),s._v("\n配置插件 "),e("code",[s._v("webpack.HotModuleReplacementPlugin()")]),s._v("及 devServer.hot 开启，需要增加自定义代码，开启热更新有代价，依据情况选择")]),s._v(" "),e("div",{staticClass:"language-js line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("module"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("hot"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n   module"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("hot"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("accept")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./print.js'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//  执行需要更新的代码")]),s._v("\n   "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("p",[s._v("更多关于本地开发环境的配置，单独进行总结")]),s._v(" "),e("h2",{attrs:{id:"七、安装相关插件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#七、安装相关插件"}},[s._v("#")]),s._v(" 七、安装相关插件")]),s._v(" "),e("ul",[e("li",[s._v("html-webpack-plugin 生成HTML，并插入资源")]),s._v(" "),e("li",[s._v("clean-webpack-plugin 删除output的输出目录内容")]),s._v(" "),e("li",[s._v("mini-css-extract-plugin 提取css")]),s._v(" "),e("li",[s._v("optimize-css-assets-webpack-plugin 压缩css")]),s._v(" "),e("li",[s._v("terser-webpack-plugin 使用 terser 来压缩 JavaScript，（production 默认开启）")])]),s._v(" "),e("h2",{attrs:{id:"八、区分环境"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#八、区分环境"}},[s._v("#")]),s._v(" 八、区分环境")]),s._v(" "),e("blockquote",[e("ol",[e("li",[s._v("使用脚本命令指定不同的配置文件")]),s._v(" "),e("li",[s._v("通过脚本传入不同的环境变量，在同一个配置文件内进行判断")])])]),s._v(" "),e("ul",[e("li",[s._v("配置npm script")]),s._v(" "),e("li",[s._v("webpack-merge 拆分")])])])}),[],!1,null,null,null);a.default=n.exports}}]);