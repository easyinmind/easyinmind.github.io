(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{432:function(v,t,a){"use strict";a.r(t);var e=a(21),_=Object(e.a)({},(function(){var v=this,t=v.$createElement,a=v._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":v.$parent.slotKey}},[a("h2",{attrs:{id:"机器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#机器"}},[v._v("#")]),v._v(" 机器")]),v._v(" "),a("ul",[a("li",[v._v("Jenkisns 机器 =》122")]),v._v(" "),a("li",[v._v("dev 机器 =》72")]),v._v(" "),a("li",[v._v("beta 机器 =》30")]),v._v(" "),a("li",[v._v("production 机器 =》 113/142")])]),v._v(" "),a("h2",{attrs:{id:"环境"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#环境"}},[v._v("#")]),v._v(" 环境")]),v._v(" "),a("ul",[a("li",[v._v("dev: dev1/dev1/dev2/dev3")]),v._v(" "),a("li",[v._v("beta: beta/beta1/beat2")]),v._v(" "),a("li",[v._v("production: production")])]),v._v(" "),a("h2",{attrs:{id:"发布流程简述"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#发布流程简述"}},[v._v("#")]),v._v(" 发布流程简述")]),v._v(" "),a("ul",[a("li",[v._v("点击发布之后，jenkins会根据配置及选择拉取git仓库代码到指定目录下（参考jenkins配置）"),a("code",[v._v("/var/lib/jenkins/workspace/hxxk-build-(环境名dev/dev1/beta/beta1/production..)")])]),v._v(" "),a("li",[v._v("然后会执行jenkins配置的对应脚本，进行依赖安装、打包编译，将打包完的静态资源scp到对应环境的机器上")])]),v._v(" "),a("h2",{attrs:{id:"dev环境流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dev环境流程"}},[v._v("#")]),v._v(" dev环境流程")]),v._v(" "),a("ol",[a("li",[v._v("点击发布，拉取代码到jenkins机器指定目录")]),v._v(" "),a("li",[v._v("执行配置脚本\n"),a("ol",[a("li",[v._v("npm install && npm run build")]),v._v(" "),a("li",[v._v("ssh dev环境的机器 rm上次的资源")]),v._v(" "),a("li",[v._v("ssh dev环境的机器 scp静态资源到dev环境机器")])])])]),v._v(" "),a("h2",{attrs:{id:"beta"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#beta"}},[v._v("#")]),v._v(" beta")]),v._v(" "),a("blockquote",[a("p",[v._v("beta环境的发布会在jenkins机器上保留历史编译产物，beta1/beta2作为测试使用，beta环境作为线上环境上线的预编译发布环境")])]),v._v(" "),a("ol",[a("li",[v._v("拉取代码")]),v._v(" "),a("li",[v._v("编译打包，将前缀(beta/beta1/beta2)+时间戳作为版本号保存当前静态资源\n"),a("ul",[a("li",[v._v("如果是beta，则不会增加前缀只使用时间戳作为版本，方便线上环境上线的时候使用")])])]),v._v(" "),a("li",[v._v("根据版本号在beta机器上创建文件夹，将静态资源scp到新创建的目录内")]),v._v(" "),a("li",[v._v("删除beta环境之前的软链，创建新的软链指向新创建的目录")]),v._v(" "),a("li",[v._v("遍历beta环境之前的历史版本，删除最早的一个，持续保证N个历史版本，方便回退")])]),v._v(" "),a("h2",{attrs:{id:"production"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#production"}},[v._v("#")]),v._v(" production")]),v._v(" "),a("blockquote",[a("p",[v._v("线上环境上线之前必须先发beta环境，线上环境发版不进行编译打包，直接scp jenkins环境beta")])]),v._v(" "),a("ol",[a("li",[v._v("获取jenkins机器上最新beta预编译静态资源，并获取版本号（时间戳的文件名）")]),v._v(" "),a("li",[v._v("根据版本号在线上机器创建新的目录，将beta最新的静态资源scp到新的目录")]),v._v(" "),a("li",[v._v("删除之前的软链，新建软链指向最新创建的目录")]),v._v(" "),a("li",[v._v("遍历历史资源，删除最早的一个，持续保留N个历史记录，方便回退")])]),v._v(" "),a("h2",{attrs:{id:"roll-back"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#roll-back"}},[v._v("#")]),v._v(" roll-back")]),v._v(" "),a("blockquote",[a("p",[v._v("版本回退，一般只需要回退beta和线上环境即可")])]),v._v(" "),a("ol",[a("li",[v._v("在要回退的环境机器上获取所有持续保留的静态资源文件版本号")]),v._v(" "),a("li",[v._v("根据配置的参数，遍历版本号判断出要回退的版本")]),v._v(" "),a("li",[v._v("删除软链，新建软链指向这个版本")])]),v._v(" "),a("h2",{attrs:{id:"jenkin机器目录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jenkin机器目录"}},[v._v("#")]),v._v(" jenkin机器目录")]),v._v(" "),a("p",[v._v("针对每个环境，jenkins都会有一个运行目录，如：dev1-build、dev2-build、beta-build等。从git上拉取的代码，及install依赖、build都会在这个目录内进行。可以理解为本地开发环境。"),a("br"),v._v("\n可以将beta（预编译、预发布）环境历史构建静态资源统一保留在一个目录，如：build-package，这样真正发布线上环境的时候只需要scp最新编译好的静态资源即可，不需要再花费时间编译。")]),v._v(" "),a("h2",{attrs:{id:"dev环境机器目录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dev环境机器目录"}},[v._v("#")]),v._v(" dev环境机器目录")]),v._v(" "),a("ul",[a("li",[v._v("/xxx/xxx/dev1 最新版本")]),v._v(" "),a("li",[v._v("/xxx/xxx/dev2 最新版本")]),v._v(" "),a("li",[v._v("/xxx/xxx/dev3 最新版本")])]),v._v(" "),a("h2",{attrs:{id:"beta环境机器目录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#beta环境机器目录"}},[v._v("#")]),v._v(" beta环境机器目录")]),v._v(" "),a("ul",[a("li",[v._v("/xxx/xxx/beta软链 =》指向beta最新版本")]),v._v(" "),a("li",[v._v("/xxx/xxx/beta 版本1")]),v._v(" "),a("li",[v._v("/xxx/xxx/beta 版本2")]),v._v(" "),a("li",[v._v("/xxx/xxx/beta 版本3")]),v._v(" "),a("li",[v._v("/xxx/xxx/beta1软链 =》指向beta1最新版本")]),v._v(" "),a("li",[v._v("/xxx/xxx/beta1 版本1")]),v._v(" "),a("li",[v._v("/xxx/xxx/beta2 版本2")]),v._v(" "),a("li",[v._v("/xxx/xxx/beta3 版本3")]),v._v(" "),a("li",[v._v("...")])]),v._v(" "),a("h2",{attrs:{id:"线上环境机器目录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#线上环境机器目录"}},[v._v("#")]),v._v(" 线上环境机器目录")]),v._v(" "),a("ul",[a("li",[v._v("/xxx/xxx/线上软链 =》指向线上最新版本")]),v._v(" "),a("li",[v._v("/xxx/xxx/线上 版本1")]),v._v(" "),a("li",[v._v("/xxx/xxx/线上 版本2")]),v._v(" "),a("li",[v._v("/xxx/xxx/线上 版本3")])]),v._v(" "),a("h2",{attrs:{id:"目录内"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#目录内"}},[v._v("#")]),v._v(" 目录内")]),v._v(" "),a("p",[v._v("一般包括前端编译完的静态文件，html/css/js/img。 可以将nginx配置放在这里，方便前端配置。可以通过外部的软链，链接到这里的nginx配置。")])])}),[],!1,null,null,null);t.default=_.exports}}]);