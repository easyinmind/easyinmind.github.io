<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>项目基于Jenkins发版流程 | easyinmind</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="前端技术博客,干货,前端学习与总结。JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,github等技术文章。">
    <meta name="keywords" content="博客,个人技术博客,读书笔记">
    <meta name="theme-color" content="#11a8cd">
    <link rel="preload" href="/assets/css/0.styles.3536894a.css" as="style"><link rel="preload" href="/assets/js/app.1fdc8891.js" as="script"><link rel="preload" href="/assets/js/2.60fa7d2d.js" as="script"><link rel="preload" href="/assets/js/32.7f408941.js" as="script"><link rel="prefetch" href="/assets/js/10.ab6f1031.js"><link rel="prefetch" href="/assets/js/11.6a6b2617.js"><link rel="prefetch" href="/assets/js/12.9d3331f6.js"><link rel="prefetch" href="/assets/js/13.bb0350a7.js"><link rel="prefetch" href="/assets/js/14.975d9f17.js"><link rel="prefetch" href="/assets/js/15.f8cf1f40.js"><link rel="prefetch" href="/assets/js/16.6343f575.js"><link rel="prefetch" href="/assets/js/17.28d8a32c.js"><link rel="prefetch" href="/assets/js/18.129a9d05.js"><link rel="prefetch" href="/assets/js/19.b8425093.js"><link rel="prefetch" href="/assets/js/20.21e6b1c5.js"><link rel="prefetch" href="/assets/js/21.6fc49af2.js"><link rel="prefetch" href="/assets/js/22.f90e060b.js"><link rel="prefetch" href="/assets/js/23.130adfe8.js"><link rel="prefetch" href="/assets/js/24.5ccf48fb.js"><link rel="prefetch" href="/assets/js/25.96a7521f.js"><link rel="prefetch" href="/assets/js/26.ff451d09.js"><link rel="prefetch" href="/assets/js/27.571f30bd.js"><link rel="prefetch" href="/assets/js/28.14e4b830.js"><link rel="prefetch" href="/assets/js/29.b098d242.js"><link rel="prefetch" href="/assets/js/3.62075db1.js"><link rel="prefetch" href="/assets/js/30.00b92b99.js"><link rel="prefetch" href="/assets/js/31.ba49332a.js"><link rel="prefetch" href="/assets/js/33.2a78dcdf.js"><link rel="prefetch" href="/assets/js/4.75bcf19e.js"><link rel="prefetch" href="/assets/js/5.55c4a00e.js"><link rel="prefetch" href="/assets/js/6.364ae047.js"><link rel="prefetch" href="/assets/js/7.f0370d72.js"><link rel="prefetch" href="/assets/js/8.46352cd6.js"><link rel="prefetch" href="/assets/js/9.dc43f98b.js">
    <link rel="stylesheet" href="/assets/css/0.styles.3536894a.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-body-img"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="https://cdn.jsdelivr.net/gh/easyinmind/cdn_file/blog/blog-photo.jpg" alt="easyinmind" class="logo"> <span class="site-name can-hide">easyinmind</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/categories/" class="nav-link">分类</a></div><div class="nav-item"><a href="/tags/" class="nav-link">标签</a></div><div class="nav-item"><a href="/archives/" class="nav-link">归档</a></div><div class="nav-item"><a href="/about/" class="nav-link">关于我</a></div><div class="nav-item"><a href="/pages/bjdct/" class="nav-link">北京的春天</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://cdn.jsdelivr.net/gh/easyinmind/cdn_file/blog/1024x1024.jpg"> <div class="blogger-info"><h3>DBY</h3> <span>学无止境</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/categories/" class="nav-link">分类</a></div><div class="nav-item"><a href="/tags/" class="nav-link">标签</a></div><div class="nav-item"><a href="/archives/" class="nav-link">归档</a></div><div class="nav-item"><a href="/about/" class="nav-link">关于我</a></div><div class="nav-item"><a href="/pages/bjdct/" class="nav-link">北京的春天</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/pages/d17ca6/" aria-current="page" class="active sidebar-link">项目基于Jenkins发版流程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/d17ca6/#机器" class="sidebar-link">机器</a></li><li class="sidebar-sub-header"><a href="/pages/d17ca6/#环境" class="sidebar-link">环境</a></li><li class="sidebar-sub-header"><a href="/pages/d17ca6/#发布流程简述" class="sidebar-link">发布流程简述</a></li><li class="sidebar-sub-header"><a href="/pages/d17ca6/#dev环境流程" class="sidebar-link">dev环境流程</a></li><li class="sidebar-sub-header"><a href="/pages/d17ca6/#beta" class="sidebar-link">beta</a></li><li class="sidebar-sub-header"><a href="/pages/d17ca6/#production" class="sidebar-link">production</a></li><li class="sidebar-sub-header"><a href="/pages/d17ca6/#roll-back" class="sidebar-link">roll-back</a></li><li class="sidebar-sub-header"><a href="/pages/d17ca6/#jenkin机器目录" class="sidebar-link">jenkin机器目录</a></li><li class="sidebar-sub-header"><a href="/pages/d17ca6/#dev环境机器目录" class="sidebar-link">dev环境机器目录</a></li><li class="sidebar-sub-header"><a href="/pages/d17ca6/#beta环境机器目录" class="sidebar-link">beta环境机器目录</a></li><li class="sidebar-sub-header"><a href="/pages/d17ca6/#线上环境机器目录" class="sidebar-link">线上环境机器目录</a></li><li class="sidebar-sub-header"><a href="/pages/d17ca6/#目录内" class="sidebar-link">目录内</a></li></ul></li><li><a href="/pages/07f380/" class="sidebar-link">CI&amp;CD</a></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-33863c7e><div class="articleInfo" data-v-33863c7e><ul class="breadcrumbs" data-v-33863c7e><li data-v-33863c7e><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-33863c7e></a></li> <li data-v-33863c7e><a href="/categories/?category=%E8%BF%90%E7%BB%B4%26%E5%85%B6%E5%AE%83" title="分类" data-v-33863c7e>运维&amp;其它</a></li> <!----> <!----></ul> <div class="info" data-v-33863c7e><div title="作者" class="author iconfont icon-touxiang" data-v-33863c7e><a href="javascript:;" data-v-33863c7e>dby</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-33863c7e><a href="javascript:;" data-v-33863c7e>2021-08-10</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><!----> <h1><!---->
          项目基于Jenkins发版流程
        </h1> <!----> <div class="theme-vdoing-content content__default"><h2 id="机器"><a href="#机器" class="header-anchor">#</a> 机器</h2> <ul><li>Jenkisns 机器 =》122</li> <li>dev 机器 =》72</li> <li>beta 机器 =》30</li> <li>production 机器 =》 113/142</li></ul> <h2 id="环境"><a href="#环境" class="header-anchor">#</a> 环境</h2> <ul><li>dev: dev1/dev1/dev2/dev3</li> <li>beta: beta/beta1/beat2</li> <li>production: production</li></ul> <h2 id="发布流程简述"><a href="#发布流程简述" class="header-anchor">#</a> 发布流程简述</h2> <ul><li>点击发布之后，jenkins会根据配置及选择拉取git仓库代码到指定目录下（参考jenkins配置）<code>/var/lib/jenkins/workspace/hxxk-build-(环境名dev/dev1/beta/beta1/production..)</code></li> <li>然后会执行jenkins配置的对应脚本，进行依赖安装、打包编译，将打包完的静态资源scp到对应环境的机器上</li></ul> <h2 id="dev环境流程"><a href="#dev环境流程" class="header-anchor">#</a> dev环境流程</h2> <ol><li>点击发布，拉取代码到jenkins机器指定目录</li> <li>执行配置脚本
<ol><li>npm install &amp;&amp; npm run build</li> <li>ssh dev环境的机器 rm上次的资源</li> <li>ssh dev环境的机器 scp静态资源到dev环境机器</li></ol></li></ol> <h2 id="beta"><a href="#beta" class="header-anchor">#</a> beta</h2> <blockquote><p>beta环境的发布会在jenkins机器上保留历史编译产物，beta1/beta2作为测试使用，beta环境作为线上环境上线的预编译发布环境</p></blockquote> <ol><li>拉取代码</li> <li>编译打包，将前缀(beta/beta1/beta2)+时间戳作为版本号保存当前静态资源
<ul><li>如果是beta，则不会增加前缀只使用时间戳作为版本，方便线上环境上线的时候使用</li></ul></li> <li>根据版本号在beta机器上创建文件夹，将静态资源scp到新创建的目录内</li> <li>删除beta环境之前的软链，创建新的软链指向新创建的目录</li> <li>遍历beta环境之前的历史版本，删除最早的一个，持续保证N个历史版本，方便回退</li></ol> <h2 id="production"><a href="#production" class="header-anchor">#</a> production</h2> <blockquote><p>线上环境上线之前必须先发beta环境，线上环境发版不进行编译打包，直接scp jenkins环境beta</p></blockquote> <ol><li>获取jenkins机器上最新beta预编译静态资源，并获取版本号（时间戳的文件名）</li> <li>根据版本号在线上机器创建新的目录，将beta最新的静态资源scp到新的目录</li> <li>删除之前的软链，新建软链指向最新创建的目录</li> <li>遍历历史资源，删除最早的一个，持续保留N个历史记录，方便回退</li></ol> <h2 id="roll-back"><a href="#roll-back" class="header-anchor">#</a> roll-back</h2> <blockquote><p>版本回退，一般只需要回退beta和线上环境即可</p></blockquote> <ol><li>在要回退的环境机器上获取所有持续保留的静态资源文件版本号</li> <li>根据配置的参数，遍历版本号判断出要回退的版本</li> <li>删除软链，新建软链指向这个版本</li></ol> <h2 id="jenkin机器目录"><a href="#jenkin机器目录" class="header-anchor">#</a> jenkin机器目录</h2> <p>针对每个环境，jenkins都会有一个运行目录，如：dev1-build、dev2-build、beta-build等。从git上拉取的代码，及install依赖、build都会在这个目录内进行。可以理解为本地开发环境。<br>
可以将beta（预编译、预发布）环境历史构建静态资源统一保留在一个目录，如：build-package，这样真正发布线上环境的时候只需要scp最新编译好的静态资源即可，不需要再花费时间编译。</p> <h2 id="dev环境机器目录"><a href="#dev环境机器目录" class="header-anchor">#</a> dev环境机器目录</h2> <ul><li>/xxx/xxx/dev1 最新版本</li> <li>/xxx/xxx/dev2 最新版本</li> <li>/xxx/xxx/dev3 最新版本</li></ul> <h2 id="beta环境机器目录"><a href="#beta环境机器目录" class="header-anchor">#</a> beta环境机器目录</h2> <ul><li>/xxx/xxx/beta软链 =》指向beta最新版本</li> <li>/xxx/xxx/beta 版本1</li> <li>/xxx/xxx/beta 版本2</li> <li>/xxx/xxx/beta 版本3</li> <li>/xxx/xxx/beta1软链 =》指向beta1最新版本</li> <li>/xxx/xxx/beta1 版本1</li> <li>/xxx/xxx/beta2 版本2</li> <li>/xxx/xxx/beta3 版本3</li> <li>...</li></ul> <h2 id="线上环境机器目录"><a href="#线上环境机器目录" class="header-anchor">#</a> 线上环境机器目录</h2> <ul><li>/xxx/xxx/线上软链 =》指向线上最新版本</li> <li>/xxx/xxx/线上 版本1</li> <li>/xxx/xxx/线上 版本2</li> <li>/xxx/xxx/线上 版本3</li></ul> <h2 id="目录内"><a href="#目录内" class="header-anchor">#</a> 目录内</h2> <p>一般包括前端编译完的静态文件，html/css/js/img。 可以将nginx配置放在这里，方便前端配置。可以通过外部的软链，链接到这里的nginx配置。</p></div></div> <!----> <div class="page-edit"><!----> <div class="tags"><a href="/tags/?tag=CI%26CD" title="标签">#CI&amp;CD</a><a href="/tags/?tag=jenkins" title="标签">#jenkins</a></div> <div class="last-updated"><span class="prefix">更新于:</span> <span class="time">2023/12/04</span></div></div> <div class="page-nav-wapper"><!----> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/pages/07f380/">CI&amp;CD</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/78d2b1/"><div>读书笔记</div></a> <span>12-04</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/93a975/"><div>vuecli</div></a> <span>11-30</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/d6c849/"><div>人类简史</div></a> <span>11-30</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2019-2023
    <span>DBY</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">跟随系统</li><li class="iconfont icon-rijianmoshi">浅色模式</li><li class="iconfont icon-yejianmoshi">深色模式</li><li class="iconfont icon-yuedu">阅读模式</li></ul></div></div> <div class="body-bg" style="background:url() center center / cover no-repeat;opacity:0.5;"></div> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.1fdc8891.js" defer></script><script src="/assets/js/2.60fa7d2d.js" defer></script><script src="/assets/js/32.7f408941.js" defer></script>
  </body>
</html>