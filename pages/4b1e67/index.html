<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>webpack原理及loader和插件 | easyinmind</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="前端技术博客,干货,前端学习与总结。JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,github等技术文章。">
    <meta name="keywords" content="前端博客,个人技术博客,前端,前端开发,前端框架,web前端,前端面试题,技术文档,学习,面试,JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,github,markdown">
    <meta name="theme-color" content="#11a8cd">
    <link rel="preload" href="/assets/css/0.styles.c6f546a7.css" as="style"><link rel="preload" href="/assets/js/app.e9ca8c87.js" as="script"><link rel="preload" href="/assets/js/2.60fa7d2d.js" as="script"><link rel="preload" href="/assets/js/11.8c02035d.js" as="script"><link rel="prefetch" href="/assets/js/10.28bccf81.js"><link rel="prefetch" href="/assets/js/12.b2a503be.js"><link rel="prefetch" href="/assets/js/13.ce8fa3a7.js"><link rel="prefetch" href="/assets/js/14.eac5bd40.js"><link rel="prefetch" href="/assets/js/15.095e9da7.js"><link rel="prefetch" href="/assets/js/16.5a484c9d.js"><link rel="prefetch" href="/assets/js/17.04e9a84d.js"><link rel="prefetch" href="/assets/js/18.c7f5f16b.js"><link rel="prefetch" href="/assets/js/19.6b712fc4.js"><link rel="prefetch" href="/assets/js/20.0c9bb1b5.js"><link rel="prefetch" href="/assets/js/21.0f5b1587.js"><link rel="prefetch" href="/assets/js/22.a8884498.js"><link rel="prefetch" href="/assets/js/23.4a94aeda.js"><link rel="prefetch" href="/assets/js/24.d9a8a94d.js"><link rel="prefetch" href="/assets/js/25.d6f86ce8.js"><link rel="prefetch" href="/assets/js/26.2f653999.js"><link rel="prefetch" href="/assets/js/27.0cad2ac4.js"><link rel="prefetch" href="/assets/js/28.f5a7b7e9.js"><link rel="prefetch" href="/assets/js/29.98cff323.js"><link rel="prefetch" href="/assets/js/3.6eb2a58a.js"><link rel="prefetch" href="/assets/js/30.542b23fc.js"><link rel="prefetch" href="/assets/js/4.75bcf19e.js"><link rel="prefetch" href="/assets/js/5.55c4a00e.js"><link rel="prefetch" href="/assets/js/6.ba3dd45d.js"><link rel="prefetch" href="/assets/js/7.f0370d72.js"><link rel="prefetch" href="/assets/js/8.f6479d16.js"><link rel="prefetch" href="/assets/js/9.73f9c98a.js">
    <link rel="stylesheet" href="/assets/css/0.styles.c6f546a7.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open no-sidebar have-body-img"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="https://cdn.jsdelivr.net/gh/easyinmind/cdn_file/blog/blog-photo.jpg" alt="easyinmind" class="logo"> <span class="site-name can-hide">easyinmind</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/categories/" class="nav-link">分类</a></div><div class="nav-item"><a href="/tags/" class="nav-link">标签</a></div><div class="nav-item"><a href="/archives/" class="nav-link">归档</a></div><div class="nav-item"><a href="/about/" class="nav-link">关于我</a></div><div class="nav-item"><a href="/pages/bjdct/" class="nav-link">北京的春天</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://cdn.jsdelivr.net/gh/easyinmind/cdn_file/blog/1024x1024.jpg"> <div class="blogger-info"><h3>DBY</h3> <span>学无止境</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/categories/" class="nav-link">分类</a></div><div class="nav-item"><a href="/tags/" class="nav-link">标签</a></div><div class="nav-item"><a href="/archives/" class="nav-link">归档</a></div><div class="nav-item"><a href="/about/" class="nav-link">关于我</a></div><div class="nav-item"><a href="/pages/bjdct/" class="nav-link">北京的春天</a></div> <!----></nav>  <!----> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-33863c7e><div class="articleInfo" data-v-33863c7e><ul class="breadcrumbs" data-v-33863c7e><li data-v-33863c7e><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-33863c7e></a></li> <li data-v-33863c7e><a href="/categories/?category=%E6%8A%80%E6%9C%AF" title="分类" data-v-33863c7e>技术</a></li> <li data-v-33863c7e><a href="/categories/?category=%E5%89%8D%E7%AB%AF" title="分类" data-v-33863c7e>前端</a></li> <!----></ul> <div class="info" data-v-33863c7e><div title="作者" class="author iconfont icon-touxiang" data-v-33863c7e><a href="javascript:;" data-v-33863c7e>dby</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-33863c7e><a href="javascript:;" data-v-33863c7e>2021-01-13</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><!----> <h1><!---->
          webpack原理及loader和插件
        </h1> <!----> <div class="theme-vdoing-content content__default"><h2 id="webpack及模块化"><a href="#webpack及模块化" class="header-anchor">#</a> webpack及模块化</h2> <p>技术发展的过程中，前端项目变得越来越复杂，通过模块化的思想组织维护复杂的项目是现在的趋势。
把复杂的代码通过功能划分为不同的模块进行维护，来提升开发效率和降低维护成本。<br>
webpack的本质还是一个模块化打包工具，webpack 把项目中的资源都看作是模块，所有的模块经过处理，再打包到一起。</p> <p>技术发展业务需求=》项目复杂=》模块化方案解决=》带来的问题=》工具解决=》webpack=》模块代码合并/不同模块资源处理/适合生产环境（兼容宿主、合理分包输出）</p> <h2 id="模块化的发展及问题"><a href="#模块化的发展及问题" class="header-anchor">#</a> 模块化的发展及问题</h2> <p>模块化思想最早通过组织文件规范、命名空间、闭包到AMD、CMD、commonjs、ESM模块化规范，现在依旧存在一些问题。</p> <ul><li>如何将散落的模块组合到一起</li> <li>如何编译代码中的新特性兼容不同宿主环境</li> <li>支持不同类型的前端资源</li></ul> <p>现在前端有Webpack、Parcel 和 Rollup都能解决上述的问题</p> <h2 id="webpack是如何解决的"><a href="#webpack是如何解决的" class="header-anchor">#</a> webpack是如何解决的</h2> <ul><li>webpack作为模块打包工具，本身就可以将分散的js打包到一起</li> <li>通过loader机制可以对代码编译兼容不同宿主环境</li> <li>webpack支持在js中以模块化的方式加载任意资源（import 'xx.css'...）</li> <li>同时webpack支持拆分的能力，可以根据生产环境的需要自定义拆分代码及资源，如将除此加载的模块单独打包到一起，其它模块等需要的时候再异步加载实现增量加载。这样在开发环境下可以通过模块化的方式开发，在生产环境下可以拆分代码，不至于所有模块打包成一个文件造成加载慢，也不至于因模块化的划分加载n多的模块。</li></ul> <h2 id="webpack的开发流程简述"><a href="#webpack的开发流程简述" class="header-anchor">#</a> webpack的开发流程简述</h2> <p>webpack 可以通过配置文件定义打包过程。 通过vscode编写配置时，在配置文件增加 <code>/** @type {import('webpack').Configuration} */</code>注释可以实现智能提示。<br> <code>mode</code> 参数简化了很多配置，预设了一些配置项，可以通过 CLI --mode 参数传入或者配置文件mode属性</p> <ul><li>production 自动优化了打包结果 （默认值）</li> <li>development 自动优化打包速度</li> <li>none 不做任何处理</li></ul> <p>webpack 是通过loader处理每个模块的资源，默认只能处理js模块，其它资需要配置不同的loader处理，再交由webpack。loader是串行处理文件的 loader1-&gt;loader2-&gt;loader3-&gt;webpack。通过在js里引入加载其它类型的资源模块，webpack会递归这些依赖，交由对应的loader处理。负责完成项目中各种各样资源模块的加载，从而实现整体项目的模块化。<br>
为何是在js里引入其它资源模块？<br>
Webpack 建议我们在 JavaScript 中引入 当前业务所需要的任意资源文件。因为真正需要这个资源的并不是整个应用，而是你此时正在编写的代码。--Webpack 的设计哲学</p> <h2 id="如何开发一个loader"><a href="#如何开发一个loader" class="header-anchor">#</a> 如何开发一个loader</h2> <p>webpack loader具有一些特性，很简单</p> <ul><li>loader需要返回一个函数（这个函数就是最资源的处理过程）</li> <li>函数 输入的（形参）就是加载到的资源文件内容，输出的（return）就是加工过的内容</li> <li>函数返回的内容可以是任意类型的，但是在loader串行运行(工作管道)完成交于webpack的时候必须是一段标准的可运行的js代码字符串如：<code>'console.log(&quot;hello loader ~&quot;)'</code></li> <li>如果js代码字符串需要导出 支持 <code>module.exports</code> 和 <code>export default</code></li></ul> <p>一个简单的注释console的 loader</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> code <span class="token operator">=</span> source<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'console.log'</span><span class="token punctuation">,</span> <span class="token string">'// console.log'</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> code
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="plugin-机制"><a href="#plugin-机制" class="header-anchor">#</a> plugin 机制</h2> <p>plugin机制 增强 webpack 在项目中自动构建方面的能力。借助plugin是webpack的能力范围更广，能实现前端工程化方面的大多数功能。
通常需要某方面功能的时候可以寻找相关插件，如清除dist构建目录，生成html，压缩打包出的文件等。相比较loader只在加载环节工作，plugin的工作范围更广，涉及到webpack运行的整个周期。<br>
如果需要自定义功能，可以自己开发一个 plugin。webpack为了扩展插件，在其运行的每个环节都埋下了一个钩子，在开发插件的时候可以根据功能的不同，在相应的钩子上挂载不同的功能来拓展webpack的能力。<br>
webpack plugin也有一些特性</p> <ul><li>必须是一个构造函数或者具有<code>apply方法</code>的类（一般会定义一个类）</li> <li><code>apply函数</code>的形参 <code>compiler</code> 包含了本次构建的所有 配置信息</li> <li>通过 <code>compiler.hooks.钩子名.tap</code> 挂载功能</li> <li><code>tap</code> 方法 接受两个参数，第一个是 <code>插件的名称</code> ，第二个是要挂载到这个钩子上的<code>功能函数</code></li> <li>在这个<code>功能函数</code>上可以接收到形参 <code>compilation 对象</code></li> <li><code>compilation对象</code> 是本次构建的上下文，通过操作这个上下文对象实现功能</li></ul> <p>一个插件模板</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">XxxPlugin</span> <span class="token punctuation">{</span>
  <span class="token function">concurstor</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>options <span class="token operator">=</span> options
  <span class="token punctuation">}</span>
  <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>emit<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">'XxxPlugin'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">compilation</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="webpack-原理简述"><a href="#webpack-原理简述" class="header-anchor">#</a> webpack 原理简述</h2> <h2 id="打包过程"><a href="#打包过程" class="header-anchor">#</a> 打包过程</h2> <ol><li>webpack启动，找到入口文件（一般为js文件）</li> <li>根据入口代码里出现的 import、require 之类的语句解析推断出入口文件依赖的资源模块</li> <li>解析每个资源模块的依赖，生成 依赖关系树</li> <li>递归依赖关系树，找到每个节点对应的资源文件，根据loader的配置交由对应的 loader加载这个模块</li> <li>将loader处理后的结果放入 打包结果中（bundle.js）</li> <li>插件不会影响整个构建过程的运行，只是在不同的运行环节增加了功能，扩展 Webpack打包功能以外 的能力</li></ol> <h2 id="原理解析"><a href="#原理解析" class="header-anchor">#</a> 原理解析</h2> <p>待更新...</p></div></div> <!----> <div class="page-edit"><!----> <!----> <div class="last-updated"><span class="prefix">更新于:</span> <span class="time">2023/11/30</span></div></div> <div class="page-nav-wapper"><!----> <!----></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/967ed7/"><div>preload&amp;prefetch</div></a> <span>09-23</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/2f93fe/"><div>webpack 概念</div></a> <span>09-04</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/d17ca6/"><div>项目基于Jenkins发版流程</div></a> <span>08-10</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2019-2023
    <span>DBY</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">跟随系统</li><li class="iconfont icon-rijianmoshi">浅色模式</li><li class="iconfont icon-yejianmoshi">深色模式</li><li class="iconfont icon-yuedu">阅读模式</li></ul></div></div> <div class="body-bg" style="background:url() center center / cover no-repeat;opacity:0.5;"></div> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.e9ca8c87.js" defer></script><script src="/assets/js/2.60fa7d2d.js" defer></script><script src="/assets/js/11.8c02035d.js" defer></script>
  </body>
</html>